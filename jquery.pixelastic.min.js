(function(a){a.pixelastic=function(b,c){var d=this;d.$el=a(b);d.el=b;if(d.$el.data("pixelastic")==undefined){d.$el.data("pixelastic",d)}else{d=d.$el.data("pixelastic")}d.methods={resize:function(){d.helpers.runFit()},bindListener:function(){a(window).bind("resize.pixelastic",d.methods.resize)},unbindListener:function(){a(window).unbind("resize.pixelastic")}};d.helpers={init:function(){d.options=a.extend({},a.pixelastic.defaultOptions,c);if(d.imgW==undefined||d.imgH==undefined){d.$el.css("position",d.options.position);d.$el.css("overflow","hidden");d.$el.css("background-color",d.options.background_color);if(!d.helpers.fitPrep()){d.$el.children("img").bind("load.pixelastic",d.helpers.fitPrep);if(d.options.overlay){var b=a("<div></div>");b.css("width","100%").css("height","100%");b.css("position","absolute").css("top","0").css("left","0");b.css("background","black");b.attr("class","pixelastic-overlay");d.$el.prepend(b)}}}if(d.options.bind_resize)d.methods.bindListener()},fitPrep:function(){var b=d.$el.children("img");var c=new Image;c.src=b.attr("src");d.imgH=c.height;d.imgW=c.width;c=null;if(d.imgW==0||d.imgW==0)return false;var b=d.$el.children("img");d.options.position_x=d.helpers.reformatPosition(d.options.position_x);d.options.position_y=d.helpers.reformatPosition(d.options.position_y);newW=d.$el.width();newH=d.$el.height();if(d.supported_browser){d.$el.css("background-image","url("+b.attr("src")+")");d.$el.css("background-position",d.options.position_x*100+"% "+d.options.position_y*100+"%");d.$el.css("background-repeat","no-repeat");if(d.options.clean)b.remove();else b.css("visibility","hidden")}else{b.css("width",newW+"px").css("height",newH+"px");var e=a("<div></div>");e.css("width","100%").css("height","100%").css("overflow","hidden").css("position","relative");b.appendTo(e);e.appendTo(d.$el)}d.helpers.runFit();d.$el.children(".pixelastic-overlay").fadeOut(function(){a(this).remove()});if(d.options.constrain)d.$el.css("max-width",d.imgW+"px").css("max-height",d.imgH+"px");return true},runFit:function(){if(d.imgW==0||d.imgW==0)return;switch(d.options.fit_type){case"cover":d.helpers.coverFit();break;case"width":d.helpers.widthFit();break;case"height":d.helpers.heightFit();break;case"contain":d.helpers.containFit();break;case"focus":d.helpers.focusFit();break}},coverFit:function(){newW=d.$el.width();newH=d.$el.height();var a=d.imgH/d.imgW;var b=d.imgW/d.imgH;if(d.supported_browser){d.$el.css("background-position",d.options.position_x*100+"% "+d.options.position_y*100+"%");if(d.options.use_best_css){d.$el.css("background-size","cover")}else{if(newH/newW<a)d.$el.css("background-size",newW+"px "+a*newW+"px");else d.$el.css("background-size",b*newH+"px "+newH+"px")}}else{var c=d.$el.find("img");if(newH/newW<a)c.css("width",newW+"px").css("height",a*newW+"px");else c.css("width",b*newH+"px").css("height",newH+"px");c.css("position","absolute");c.css("top",(newH-c.height())*d.options.position_y);c.css("left",(newW-c.width())*d.options.position_x)}},widthFit:function(){newW=d.$el.width();newH=d.$el.height();if(d.supported_browser){d.$el.css("background-size","100% "+Math.round(d.imgH*(newW/d.imgW))+"px");d.$el.css("background-position","50% 50%")}else{var a=d.$el.find("img");a.width("100%").height(Math.round(d.imgH*(a.width()/d.imgW)));a.css("margin","auto")}},heightFit:function(){newW=d.$el.width();newH=d.$el.height();if(d.supported_browser){d.$el.css("background-size",Math.round(d.imgW*(newH/d.imgH))+"px 100%");d.$el.css("background-position","50% 50%")}else{var a=d.$el.find("img");a.height("100%").width(Math.round(d.imgW*(a.height()/d.imgH)));a.css("margin","auto")}},containFit:function(){if(d.options.use_best_css){d.$el.css("background-size","contain")}else{newW=d.$el.width();newH=d.$el.height();var a=newW/d.imgW;var b=newH/d.imgH;if(b>a)d.helpers.widthFit();else d.helpers.heightFit()}},focusFit:function(){newW=d.$el.width();newH=d.$el.height();var a,b;if(d.options.constrain){a=d.imgW;b=d.imgH}else{a=Math.max(newW,d.imgW);b=Math.max(newH,d.imgH)}if(d.supported_browser){d.$el.css("background-position",d.options.position_x*100+"% "+d.options.position_y*100+"%");d.$el.css("background-size",a+"px "+b+"px")}else{var c=d.$el.find("img");c.css("width",a).css("height",b);c.css("top",(newH-c.height())*d.options.position_y);c.css("left",(newW-c.width())*d.options.position_x)}},browserSupport:function(){if(window.Modernizr){return Modernizr.testProp("backgroundSize")}else{var a=document.createElement("div");var b=!!(0+a.style["background-size"]);return b}},reformatPosition:function(b){switch(b){case"top":return 0;break;case"bottom":return 1;break;case"left":return 0;break;case"right":return 1;break;case"center":return.5;break}var c=undefined;if(b.indexOf("%")!=-1||b.indexOf("px")!=-1)c=parseFloat(b);if(isNaN(c))a.error('pixelastic: "'+b+'" does not appear to be a valid position value.');else return c/100;a.error('pixelastic: "'+b+'" does not appear to be a valid position value.')}};if(d.methods[c]){d.methods[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){d.supported_browser=d.helpers.browserSupport();d.helpers.init()}else{a.error('Method "'+c+'" does not exist in pixelastic!')}};a.pixelastic.defaultOptions={constrain:1,fit_type:"cover",use_best_css:1,position_x:"center",position_y:"center",overlay:1,bind_resize:0,clean:1,background_color:"#000000",position:"relative"};a.fn.pixelastic=function(b){return this.each(function(){new a.pixelastic(this,b)})}})(jQuery)